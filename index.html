<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title data-i18n="meta_title">SudokQuizz — Sudoku + Quiz</title>
    <meta name="description" content="" data-i18n-meta="meta_description" />
    <link rel="stylesheet" href="./css/styles.css" />
  </head>
  <body>
    <header class="hero">
      <div class="hero-inner">
        <img class="app-icon" src="./assets/icon/ic_launcher_512.png" alt="SudokQuizz icon" onerror="this.style.display='none'" />
        <div>
          <div class="top-row" style="display:flex;align-items:center;gap:12px;justify-content:space-between;">
            <div>
              <h1 data-i18n="title">SudokQuizz</h1>
              <p class="tag" data-i18n="tag">Sudoku + Quiz — train your logic and knowledge</p>
            </div>
            <div class="lang-switch" aria-label="Language switch">
              <button class="lang-btn" data-lang="en" onclick="setSiteLang('en')">EN</button>
              <button class="lang-btn" data-lang="fr" onclick="setSiteLang('fr')">FR</button>
              <button class="lang-btn" data-lang="es" onclick="setSiteLang('es')">ES</button>
            </div>
          </div>
          <p class="lead" data-i18n="lead">Solve grids, answer quizzes and earn jokers. Free on Google Play.</p>
          <div class="actions">
            <a class="btn primary" href="#download" data-i18n="download_btn">Download</a>
            <a class="btn ghost" href="./privacy.html" data-i18n="privacy_btn">Privacy policy</a>
          </div>
        </div>
      </div>
      <img class="feature-graphic" src="./assets/feature-graphic/feature_graphic_1024x500.png" alt="Feature" onerror="this.style.display='none'" />
    </header>

    <main class="container">
      <section id="about">
        <h2 data-i18n="about_title">About</h2>
        <p data-i18n="about_text">SudokQuizz blends Sudoku with general-knowledge quiz questions. Pick a difficulty, solve the grid and unlock jokers by watching short rewarded videos.</p>
      </section>

      <section id="features">
        <h2 data-i18n="features_title">Features</h2>
        <ul class="features-list">
          <li data-i18n="features_1"><strong>Multiple levels:</strong> easy → expert</li>
          <li data-i18n="features_2"><strong>16 quiz categories</strong> (geography, history, science...)</li>
          <li data-i18n="features_3"><strong>Jokers</strong> unlockable via rewarded ads</li>
          <li data-i18n="features_4"><strong>Multilingual:</strong> EN / FR / ES</li>
          <li data-i18n="features_5"><strong>GDPR compliance:</strong> consent and privacy policy</li>
        </ul>
      </section>

      <section id="download">
        <h2 data-i18n="download_title">Download</h2>
        <p>
          <span data-i18n="download_text">SudokQuizz is published on Google Play. Use the link below to open the store page.</span>
          <a class="download-link" href="https://play.google.com/store/apps/details?id=com.sudokquizz" target="_blank" rel="noopener" data-i18n="download_open">Open Play Store listing</a>
          <a class="download-badge" href="https://play.google.com/store/apps/details?id=com.sudokquizz" target="_blank" rel="noopener" aria-label="Open Play Store listing">
            <img class="play-badge" src="./assets/icon/GetItOnGooglePlay_Badge_Web_color_English.png" alt="Get it on Google Play" onerror="this.style.display='none'" />
          </a>
        </p>
      </section>

      <section id="screenshots">
        <h2 data-i18n="video_title">Promo video</h2>
        <!-- Download block moved above the promo video -->

        <div class="video-block">
          <!-- YouTube embed (responsive) -->
          <div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;max-width:100%;">
            <iframe
              src="https://www.youtube.com/embed/CUTHzCPOhfU?rel=0&showinfo=0"
              title="Présentation SudokQuizz"
              style="position:absolute;top:0;left:0;width:100%;height:100%;border:0;"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
              allowfullscreen
            ></iframe>
          </div>
        </div>

        <h2 data-i18n="screenshots_title">Screenshots</h2>
        <div class="gallery" id="gallery">
          <!-- screenshots are rendered dynamically per-language by renderScreenshots() -->
        </div>
      </section>

      <section id="download">
        <h2 data-i18n="download_title">Download</h2>
        <p>
          <span data-i18n="download_text">SudokQuizz is published on Google Play. Use the link below to open the store page.</span>
          <a class="download-link" href="https://play.google.com/store/apps/details?id=com.sudokquizz" target="_blank" rel="noopener" data-i18n="download_open">Open Play Store listing</a>
          <a class="download-badge" href="https://play.google.com/store/apps/details?id=com.sudokquizz" target="_blank" rel="noopener" aria-label="Open Play Store listing">
            <img class="play-badge" src="./assets/icon/GetItOnGooglePlay_Badge_Digital_color_Finnish.png" alt="Get it on Google Play" onerror="this.style.display='none'" />
          </a>
        </p>
      </section>

      <section id="privacy">
        <h2 data-i18n="privacy_title">Privacy</h2>
        <p>
          <span data-i18n="privacy_text">The full privacy policy is published here:</span>
          <a id="privacy-link" class="privacy-link" href="./privacy.html" data-i18n="privacy_link_text">Privacy policy on site</a>
        </p>
      </section>
    </main>

    <footer class="footer">
      <div class="container">
        <p>
          <span id="year">2025</span>
          <span style="margin-left:8px;" data-i18n="footer_text">SudokQuizz — All trademarks belong to their respective owners.</span>
          <a id="footer-privacy-link" href="./privacy.html" style="margin-left:12px;" data-i18n="privacy_link_text">Privacy policy on site</a>
        </p>
      </div>
    </footer>

    <script>
      // Prioritise ./assets/ when available. For each element referencing ../playstore-assets/
      // try fetching the equivalent path under ./assets/; if the fetch succeeds, swap the src/poster.
        async function preferLocalAssets() {
          const oldPrefix = '../playstore-assets/';
          const newPrefix = './assets/';

          // helper: try to fetch and return true if available
          async function exists(url) {
            try {
              const res = await fetch(url, { method: 'GET', cache: 'no-cache' });
              return res.ok;
            } catch (e) {
              return false;
            }
          }

          // images
          document.querySelectorAll('img').forEach(async img => {
            const src = img.getAttribute('src') || '';
            if (src.startsWith(oldPrefix)) {
              const candidate = src.replace(oldPrefix, newPrefix);
              if (await exists(candidate)) img.src = candidate;
            }
          });

          // video sources and posters
          document.querySelectorAll('video').forEach(async video => {
            const poster = video.getAttribute('poster') || '';
            if (poster.startsWith(oldPrefix)) {
              const candidate = poster.replace(oldPrefix, newPrefix);
              if (await exists(candidate)) video.setAttribute('poster', candidate);
            }

            video.querySelectorAll('source').forEach(async source => {
              const s = source.getAttribute('src') || '';
              if (s.startsWith(oldPrefix)) {
                const candidate = s.replace(oldPrefix, newPrefix);
                if (await exists(candidate)) source.src = candidate;
              }
            });
          });

          // update year
          const yearEl = document.getElementById('year');
          if (yearEl) yearEl.textContent = new Date().getFullYear();
        }

        // Also keep a visual fallback for broken images
        document.addEventListener('DOMContentLoaded', function(){
          preferLocalAssets();
          document.querySelectorAll('img').forEach(img=>{
            img.addEventListener('error', ()=>img.style.opacity=0.6);
          });
        });

        // i18n: single-page approach using JSON files in ./lang/
        async function loadLangFile(lang){
          try{
            const res = await fetch(`./lang/${lang}.json`, {cache: 'no-cache'});
            if(!res.ok) throw new Error('not found');
            return await res.json();
          }catch(e){
            return null;
          }
        }

        function applyTranslations(t){
          if(!t) return;
          // set simple text nodes
          document.querySelectorAll('[data-i18n]').forEach(el=>{
            const key = el.getAttribute('data-i18n');
            if(t[key]!==undefined) el.textContent = t[key];
          });
          // set attributes like alt
          document.querySelectorAll('[data-i18n-attr-alt]').forEach(el=>{
            const key = el.getAttribute('data-i18n-attr-alt');
            if(t[key]!==undefined) el.setAttribute('alt', t[key]);
          });
          // set meta description
          document.querySelectorAll('[data-i18n-meta]').forEach(meta=>{
            const key = meta.getAttribute('data-i18n-meta');
            if(t[key]!==undefined) meta.setAttribute('content', t[key]);
          });
          // set title tag if present
          const titleEl = document.querySelector('title[data-i18n]');
          if(titleEl){
            const key = titleEl.getAttribute('data-i18n');
            if(t[key]!==undefined) document.title = t[key];
          }
          // update active lang button
          document.querySelectorAll('.lang-btn').forEach(btn=>{
            btn.classList.toggle('active', btn.getAttribute('data-lang')===currentLang);
          });
            // render screenshots appropriate for the active language
            try{ renderScreenshots();
              // also set alt attributes for the freshly created images
              document.querySelectorAll('[data-i18n-attr-alt]').forEach(el=>{
                const key = el.getAttribute('data-i18n-attr-alt');
                if(t[key]!==undefined) el.setAttribute('alt', t[key]);
              });
            }catch(e){/* ignore if not available */}
          // update privacy links to language-specific policy
          try{
            const privacyEn = 'https://github.com/btouchon/SudokQuizz-privacy-policy/blob/main/PRIVACY_POLICY_EN.md';
            const privacyFr = 'https://github.com/btouchon/SudokQuizz-privacy-policy/blob/main/PRIVACY_POLICY.md';
            const chosen = (currentLang === 'fr') ? privacyFr : privacyEn;
            document.querySelectorAll('a[href*="SudokQuizz-privacy-policy"]').forEach(a=>{
              a.setAttribute('href', chosen);
            });
          }catch(e){/* ignore */}
          // set html lang attribute for accessibility/SEO
          try{ document.documentElement.lang = currentLang; }catch(e){}
        }

        // Render the screenshots gallery using all images available per language.
        function renderScreenshots(){
          const gallery = document.getElementById('gallery');
          if(!gallery) return;

          // explicit file lists per language (keeps order predictable)
          const filesList = {
            en: [
              'EN01-accueil-difficultes.png',
              'EN02-selection-categories.png',
              'EN03-grille-sudoku-jeu.png',
              'EN04-modale-question-quiz.png',
              'EN05-grille-progression.png',
              'EN06-modale-victoire.png',
              'EN07-parametres-multilingue.png',
              'EN08-joker-en-action.png'
            ],
            fr: [
              '01-accueil-difficultes.png',
              '02-selection-categories.png',
              '03-grille-sudoku-jeu.png',
              '04-modale-question-quiz.png',
              '05-grille-progression.png',
              '06-modale-victoire.png',
              '07-parametres-multilingue.png',
              '08-joker-en-action.png'
            ],
            es: [
              '01-accueil-difficultes.png',
              '02-selection-categories.png',
              '03-grille-sudoku-jeu.png',
              '04-modale-question-quiz.png',
              '05-grille-progression.png',
              '06-modale-victoire.png',
              '07-parametres-multilingue.png',
              '08-joker-en-action.png'
            ]
          };

          const files = filesList[currentLang] || filesList.en;
          gallery.innerHTML = '';
          files.forEach((filename, idx) => {
            const img = document.createElement('img');
            img.src = `./assets/screenshots/phone/${currentLang}/${filename}`;
            img.alt = '';
            img.loading = 'lazy';
            img.addEventListener('error', ()=>{ img.dataset.missing='true'; img.style.opacity=0.6; });
            gallery.appendChild(img);
          });
        }

        let currentLang = 'en';
        async function initI18n(){
          const saved = localStorage.getItem('site_lang');
          const browser = (navigator.language||'en').split('-')[0];
          currentLang = saved || (['en','fr','es'].includes(browser)?browser:'en');
          let t = await loadLangFile(currentLang);
          if(!t && currentLang!=='en') t = await loadLangFile('en');
          applyTranslations(t);
        }

        window.setSiteLang = async function(newLang){
          if(!newLang) return;
          const t = await loadLangFile(newLang) || await loadLangFile('en');
          if(t){
            currentLang = newLang;
            applyTranslations(t);
            localStorage.setItem('site_lang', newLang);
          }
        }

        // start i18n once DOM is ready (preferLocalAssets already runs there)
        document.addEventListener('DOMContentLoaded', function(){
          initI18n();
        });
    </script>
  </body>
</html>
